<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Apache Airflow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css"
          integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    <meta name="google-site-verification" content="nKBS68MBglsXyUBNGGsQ7oQZU53wrBmnye0L6Fu4jBU"/>
    <script src="https://browser.sentry-cdn.com/4.6.5/bundle.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">Sentry.init({dsn: 'https://802d42edef034b74860743196de2cac2@sentry.io/1423759'});</script>
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <link rel="apple-touch-icon" sizes="144x144" href="/upload/img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/upload/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/upload/img/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/upload/img/icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/upload/img/icons/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
<div class="container">
    <div class="py-5 text-center">
        <h1>Apache Airflow</h1>
        <h4>Complete guide</h4>
    </div>
</div>
<hr/>
<div class="container">
    <div>
        <p>
            <b>Introduction.</b> Airflow is a platform to programmatically author, schedule and monitor workflows. Use
            Airflow to author workflows as Directed Acyclic Graphs (DAGs) of tasks. The Airflow scheduler executes your
            tasks on an array of workers while following the specified dependencies. Workflows are expected to be mostly
            static or slowly changing. You can think of the structure of the tasks in your workflow as slightly more
            dynamic than a database structure would be. Airflow workflows are expected to look similar from a run to the
            next, this allows for clarity around unit of work and continuity.
        </p>
    </div>
    <hr/>
    <h3>High level architecture</h3>
    <div>
        <img src="assets/arch-diag-basic.png" alt="" class="img-fluid"/>
    </div>
    <p>An Airflow installation generally consists of the following components:</p>
    <ul>
        <li>A scheduler, which handles both triggering scheduled workflows, and submitting Tasks to the executor to
            run.
        </li>
        <li>An executor, which handles running tasks. In the default Airflow installation, this runs everything inside
            the scheduler, but most production-suitable executors actually push task execution out to workers.
        </li>
        <li>A webserver, which presents a handy user interface to inspect, trigger and debug the behaviour of DAGs and
            tasks.
        </li>
        <li>A folder of DAG files, read by the scheduler and executor (and any workers the executor has)</li>
        <li>A metadata database, used by the scheduler, executor and webserver to store state.</li>
    </ul>
    <hr/>
    <h3>Components</h3>
    <p>Airflow is a platform that lets you build and run workflows. A workflow is represented as a DAG (a Directed
        Acyclic Graph), and contains individual pieces of work called Tasks, arranged with dependencies and data flows
        taken into account.</p>
    <ul>
        <li>Operators, predefined tasks that you can string together quickly to build most parts of your DAGs.</li>
        <li>Sensors, a special subclass of Operators which are entirely about waiting for an external event to happen.
        </li>
        <li>A TaskFlow-decorated @task, which is a custom Python function packaged up as a Task.</li>
    </ul>
    <h4>#1 Simple Example</h4>
    <p>Lets look at example dag with single task:</p>
    <ul>
        <li>@dag is collections of tasks. When dag is active it executes sequence of tasks.</li>
        <li>@task is unit of work.</li>
        <li>Operator is abstraction for interact with external systems.</li>
    </ul>
    <pre><code class="python">@dag(schedule_interval=None, start_date=datetime(2021, 1, 1), catchup=False, tags=['example'])
def example_dag_decorator(email: str = 'example@example.com'):
    get_ip = GetRequestOperator(task_id='get_ip', url="http://httpbin.org/get")

    @task(multiple_outputs=True)
    def prepare_email(raw_json: Dict[str, Any]) -&gt; Dict[str, str]:
        external_ip = raw_json['origin']
        return {
            'subject': f'Server connected from {external_ip}',
            'body': f'Seems like today your server executing Airflow is connected from IP {external_ip}&lt;br&gt;',
        }

    email_info = prepare_email(get_ip.output)

    EmailOperator(
        task_id='send_email', to=email, subject=email_info['subject'], html_content=email_info['body']
    )


dag = example_dag_decorator()</code></pre>
    <p>By default, a DAG will only run a Task when all the Tasks it depends on are successful. There are several ways of
        modifying this, however:</p>
    <ul>
        <li>Branching, where you can select which Task to move onto based on a condition</li>
        <li>Latest Only, a special form of branching that only runs on DAGs running against the present</li>
        <li>Depends On Past, where tasks can depend on themselves from a previous run</li>
        <li>Trigger Rules, which let you set the conditions under which a DAG will run a task.</li>
    </ul>
    <h4>#2 Dag with multiple steps</h4>
    <div>
        <p>{{ Enter text here }} </p>
    </div>
    <h4>#3 Sensors</h4>
    ...
    <h4>#4 XCOM</h4>
    ...
    <h4>#5 Variables</h4>
    ...
    <hr/>
    <h3>Executors</h3>
    ...

    <div>
        <hr/>
        <b>Related articles</b>:
        <ul>
            <li><a href="https://airflow.apache.org/docs/">Airflow Documentation</a></li>
        </ul>
    </div>
    <div class="text-right">
        <script type="text/javascript"
                src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ca389f3b6700245"></script>
        <div class="addthis_inline_share_toolbox"></div>
    </div>
</div>
<script>hljs.initHighlightingOnLoad();</script>
<!-- Yandex.Metrika counter -->
<script type="text/javascript"> (function (d, w, c) {
    (w[c] = w[c] || []).push(function () {
        try {
            w.yaCounter41245659 = new Ya.Metrika2({
                id: 41245659,
                clickmap: true,
                trackLinks: true,
                accurateTrackBounce: true,
                webvisor: true,
                trackHash: true
            });
        } catch (e) {
        }
    });
    var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () {
        n.parentNode.insertBefore(s, n);
    };
    s.type = "text/javascript";
    s.async = true;
    s.src = "https://mc.yandex.ru/metrika/tag.js";
    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else {
        f();
    }
})(document, window, "yandex_metrika_callbacks2"); </script>
<noscript>
    <div><img src="https://mc.yandex.ru/watch/41245659" style="position:absolute; left:-9999px;" alt=""/></div>
</noscript> <!-- /Yandex.Metrika counter -->
</body>
</html>
